<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dark Tech Zone | Ultra Web + Firebase</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --neon:#00ffcc;
      --pink:#ff00ff;
      --glass:rgba(255,255,255,.08);
      --text:#e8f6f2;
      --bg:#000;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto;
      background:var(--bg);
      color:var(--text);
      overflow:hidden;
    }
    canvas#bg{position:fixed;inset:0;z-index:-2}
    .watermark{
      position:fixed; inset:0; display:flex; justify-content:center; align-items:center;
      font-size:26px; font-weight:700; opacity:.06; transform:rotate(-21deg);
      pointer-events:none; z-index:999; text-align:center; line-height:1.4; user-select:none;
    }
    .topbar{
      position:fixed; top:0; left:0; right:0; height:56px;
      display:flex; align-items:center; justify-content:space-between; padding:0 14px;
      background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.15));
      backdrop-filter:blur(10px); border-bottom:1px solid rgba(0,255,204,.15); z-index:50;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.4px;
      color:var(--neon); text-shadow:0 0 10px var(--neon);
    }
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--pink);box-shadow:0 0 12px var(--pink);animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.6)}}
    .actions{display:flex;gap:10px;align-items:center}
    .mini-btn{
      padding:8px 12px;border-radius:10px;border:1px solid rgba(0,255,204,.25);
      background:rgba(0,0,0,.5);color:#fff;cursor:pointer;font-weight:600;
    }
    .page{
      position:absolute; inset:56px 0 0 0; display:flex; justify-content:center; align-items:center;
      opacity:0; transform:scale(.96) translateY(30px);
      transition:opacity .6s cubic-bezier(.2,.8,.2,1), transform .6s cubic-bezier(.2,.8,.2,1);
      pointer-events:none; padding:20px;
    }
    .page.active{opacity:1;transform:none;pointer-events:auto}
    .card{
      width:100%; max-width:500px; padding:26px; border-radius:24px; background:var(--glass);
      backdrop-filter:blur(28px) saturate(120%);
      box-shadow:0 0 26px rgba(0,255,204,.25), inset 0 0 120px rgba(255,255,255,.05);
      border:1px solid rgba(0,255,204,.25);
    }
    .card h1,.card h2{text-align:center;color:var(--neon);margin:10px 0 16px}
    .card p{text-align:center;font-size:14px;opacity:.85;margin:0 0 14px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .spacer{height:8px}
    input,select,button,textarea{
      width:100%; padding:12px; margin:8px 0; border-radius:14px; border:none; font-family:inherit; font-size:14px; outline:none;
    }
    input,select,textarea{
      background:#000; color:#fff; border:1px solid rgba(0,255,204,.35);
    }
    button{
      background:linear-gradient(135deg,var(--neon),var(--pink));
      font-weight:700; cursor:pointer; color:#001a14;
    }
    .back{
      position:absolute; top:70px; left:16px; background:none; border:1px solid rgba(0,255,204,.35);
      color:var(--neon); font-size:16px; padding:8px 12px; border-radius:12px; cursor:pointer;
    }
    .member{
      padding:12px; margin:8px 0; border-radius:14px; background:rgba(0,255,255,.12);
      border:1px solid rgba(0,255,204,.25); display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .alert-container{
      position:fixed; top:70px; right:20px; z-index:10000; display:flex; flex-direction:column; gap:12px; max-width:360px;
    }
    .alert{
      min-width:260px; padding:14px 16px; border-radius:16px; display:flex; gap:12px; color:#001a14;
    }
    .alert.success{background:linear-gradient(135deg,#00ffcc,#00cc99)}
    .tool-menu{
      position:fixed; bottom:20px; right:20px; z-index:9999; display:flex; flex-direction:column; gap:12px; align-items:flex-end;
    }
    .tool-btn{
      width:56px; height:56px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:22px; cursor:pointer;
      background:linear-gradient(135deg,var(--neon),var(--pink)); box-shadow:0 0 20px var(--neon);
    }
    .tool-item{
      width:260px; padding:12px; border-radius:16px; background:var(--glass); backdrop-filter:blur(20px);
      display:none; align-items:center; gap:10px; cursor:pointer; border:1px solid rgba(0,255,204,.25); color:#fff;
    }
    .tool-menu.open .tool-item{display:flex}
  </style>
</head>

<body>
  <canvas id="bg"></canvas>
  <div class="watermark">DARK TECH ZONE<br>+94 778 430 626</div>

  <div class="topbar">
    <div class="brand"><span class="dot"></span> DARK TECH ZONE</div>
    <div class="actions">
      <button class="mini-btn" onclick="go('home')">Home</button>
      <button class="mini-btn" onclick="go('leaderboard')">Leaderboard</button>
      <button class="mini-btn" onclick="openCurrent()">Profile</button>
    </div>
  </div>

  <div class="alert-container" id="alerts"></div>

  <div class="tool-menu" id="toolMenu">
    <div class="tool-item" onclick="toggleMusic()">üéß Music On/Off</div>
    <div class="tool-item" onclick="go('login')">üîê User Login</div>
    <div class="tool-btn" onclick="toggleTools()">‚öôÔ∏è</div>
  </div>

  <div class="page active" id="home">
    <div class="card">
      <h1>Welcome to Dark Tech Zone</h1>
      <p>Secure team platform powered by Firebase Cloud.</p>
      <button onclick="go('login')">GET STARTED</button>
    </div>
  </div>

  <div class="page" id="login">
    <button class="back" onclick="go('home')">‚¨Ö Back</button>
    <div class="card">
      <h2>Quick Access</h2>
      <p>Sign in anonymously to start gaining points.</p>
      <button id="btnLoginAnon" onclick="signInAnon()">Enter System</button>
    </div>
  </div>

  <div class="page" id="profile">
    <div class="card">
      <h2>Profile Settings</h2>
      <input id="userName" placeholder="Display Name">
      <select id="userAvatar">
        <option value="Sphere">Sphere</option>
        <option value="Cube">Cube</option>
        <option value="Torus">Torus</option>
      </select>
      <button onclick="updateProfile()">Save to Cloud</button>
      <button onclick="addPoints()">Gain +10 Points</button>
      <button onclick="signOutUser()">Logout</button>
    </div>
  </div>

  <div class="page" id="leaderboard">
    <button class="back" onclick="go('home')">‚¨Ö Back</button>
    <div class="card">
      <h2>Real-time Leaderboard</h2>
      <div id="leaderList"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, limit, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCy4DRyQXWLo84VooUfiBmHA-GwTrqV0oc",
      authDomain: "dtz-web.firebaseapp.com",
      projectId: "dtz-web",
      storageBucket: "dtz-web.firebasestorage.app",
      messagingSenderId: "735505362592",
      appId: "1:735505362592:web:2e9f9e62fcb2791785a3c5",
      measurementId: "G-38B4E7HCVZ"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUid = null;

    // --- Auth Logic ---
    window.signInAnon = async () => {
      try {
        await signInAnonymously(auth);
        showAlert("success", "Connected", "Logged in via Firebase");
      } catch (e) {
        console.error(e);
      }
    };

    window.signOutUser = () => signOut(auth).then(() => go('home'));

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUid = user.uid;
        // Sync local UI with Cloud data
        const userRef = doc(db, "users", user.uid);
        const snap = await getDoc(userRef);
        if (snap.exists()) {
          document.getElementById('userName').value = snap.data().name || "";
          document.getElementById('userAvatar').value = snap.data().avatar || "Sphere";
        } else {
          // Initialize new user in cloud
          await setDoc(userRef, { name: "New User", points: 0, avatar: "Sphere", joined: Date.now() });
        }
        go('profile');
      } else {
        currentUid = null;
      }
    });

    // --- Firestore Data Logic ---
    window.updateProfile = async () => {
      if (!currentUid) return;
      const name = document.getElementById('userName').value;
      const avatar = document.getElementById('userAvatar').value;
      await updateDoc(doc(db, "users", currentUid), { name, avatar });
      showAlert("success", "Updated", "Profile synced to cloud");
    };

    window.addPoints = async () => {
      if (!currentUid) return;
      await updateDoc(doc(db, "users", currentUid), { points: increment(10) });
      showAlert("success", "Bonus", "+10 Points Added!");
    };

    // Real-time Leaderboard Listener
    const q = query(collection(db, "users"), orderBy("points", "desc"), limit(10));
    onSnapshot(q, (snapshot) => {
      const list = document.getElementById('leaderList');
      list.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();
        list.innerHTML += `
          <div class="member">
            <span><b>${data.name || "Anon"}</b></span>
            <span class="mini-btn">${data.points} pts</span>
          </div>`;
      });
    });
  </script>

  <script>
    function go(id){
      document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
    function toggleTools(){ document.getElementById('toolMenu').classList.toggle('open') }
    function openCurrent(){ go('profile'); }
    function showAlert(type, title, msg){
      const container = document.getElementById('alerts');
      const div = document.createElement('div');
      div.className = `alert ${type}`;
      div.innerHTML = `<b>${title}</b>: ${msg}`;
      container.appendChild(div);
      setTimeout(() => div.remove(), 3000);
    }

    // Three.js Background Logic
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 1, 1000);
    camera.position.z = 100;
    const renderer = new THREE.WebGLRenderer({canvas: bg, alpha: true});
    renderer.setSize(innerWidth, innerHeight);

    const starGeo = new THREE.BufferGeometry();
    const pts = [];
    for(let i=0;i<1000;i++) pts.push((Math.random()-.5)*1000,(Math.random()-.5)*1000,(Math.random()-.5)*1000);
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(pts,3));
    const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color:0x00ffcc, size:1}));
    scene.add(stars);

    function animate(){
      requestAnimationFrame(animate);
      stars.rotation.y += 0.001;
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>